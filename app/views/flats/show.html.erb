<h1><%= @flat.title %></h1>
<h2><%= @flat.description %></h2>
<p><%= @flat.street %></p>
<p><%= @flat.city %></p>
<p><%= @flat.country %></p>
<h3><%= @flat.price %></h3>
<%# <%= image_tag @flat.image_url %> %>

<%= simple_form_for @booking do |f| %>
  <div data-controller="booking-form" data-booking-form-price-per-night-value="<%= @flat.price %>">
  <%# f.input :start_date, as: :string, label: "Check-in", input_html: { class: "form-control datepicker", placeholder: "DD-MM-YYYY", "data-provide": "datepicker", "data-date-format": "yyyy-mm-dd", "data-date-autoclose": "true", "data-controller": "booking-form", "data-action": "change->booking-form#updateTotalPrice"} %>
  <%# f.input :end_date, as: :string, label: "Check-out", input_html: { class: "form-control datepicker", placeholder: "DD-MM-YYYY", "data-provide": "datepicker", "data-date-format": "yyyy-mm-dd", "data-date-autoclose": "true", "data-controller": "booking-form", "data-action": "change->booking-form#updateTotalPrice"} %>
  <%= f.input :start_date, as: :string, label: "Check-in", input_html: { class: "form-control datepicker", placeholder: "DD-MM-YYYY", "data-provide": "datepicker", "data-date-format": "yyyy-mm-dd", "data-date-autoclose": "true", "data-booking-form-target": "startDate", "data-action": "change->bookingForm#updateTotalPrice"} %>
  <%= f.input :end_date, as: :string, label: "Check-out", input_html: { class: "form-control datepicker", placeholder: "DD-MM-YYYY", "data-provide": "datepicker", "data-date-format": "yyyy-mm-dd", "data-date-autoclose": "true", "data-booking-form-target": "endDate", "data-action": "change->booking-form#updateTotalPrice"} %>
  <% if @booking.start_date && @booking.end_date && @booking.end_date > @booking.start_date %>
  <% price_per_night = @flat.price / (@booking.end_date - @booking.start_date).to_i %>
  <%= f.input :price_per_night, input_html: { value: price_per_night}, "data-target": "booking-form.pricePerNight"%>
  <%= f.number_field :total_price, value: @flat.price * (@booking.end_date.to_i - @booking.start_date.to_i), readonly: true %>
<% else %>
  <% price_per_night = 0 %>
  <%= f.input :price_per_night, input_html: { value: price_per_night}, "data-target": "booking-form.pricePerNight"%>
  <%= f.number_field :total_price, value: 0, readonly: true %>
<% end %>

  <%= f.button :submit, class: "btn btn-primary" %>
  </div>
<% end %>
<%= link_to "Back", flats_path(@flat) %>
